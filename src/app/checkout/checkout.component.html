<app-header></app-header>

<div class="checkout-container">
  <div class="checkout-header">
    <button class="back-btn" (click)="goBackToCart()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Vissza a kosárhoz
    </button>
    <h1>Rendelés Áttekintése</h1>
  </div>

  <div class="checkout-content">
    <!-- Left Column: Forms -->
    <div class="checkout-forms">
      
      <!-- Cart Items -->
      <div class="checkout-section">
        <h2 class="section-title">Megrendelt termékek</h2>
        <div class="cart-items">
          <div class="cart-item" *ngFor="let item of cartItems">
            <div class="item-image">
              <img [src]="'http://127.0.0.1:8080/coreTech3-1.0-SNAPSHOT/webresources/products/' + item.product_id + '/images/1'" [alt]="item.product_name" />
            </div>
            <div class="item-details">
              <h3 class="item-name">{{ item.product_name }}</h3>
              <p class="item-quantity">Mennyiség: {{ item.quantity }} db</p>
              <p class="item-price">{{ formatPrice(item.product_p_price) }}</p>
            </div>
            <div class="item-total">
              {{ formatPrice(item.product_p_price * item.quantity) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Data -->
      <div class="checkout-section">
        <div class="section-header">
          <h2 class="section-title">Vásárlói Adatok</h2>
          <button class="use-saved-btn" (click)="useSavedCustomerData()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Mentett adatok használata
          </button>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Vezetéknév *</label>
            <input type="text" [(ngModel)]="customerData.lastName" placeholder="Kovács" required />
          </div>
          <div class="form-group">
            <label>Keresztnév *</label>
            <input type="text" [(ngModel)]="customerData.firstName" placeholder="János" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>E-mail *</label>
            <input type="email" [(ngModel)]="customerData.email" placeholder="pelda@email.com" required />
          </div>
          <div class="form-group">
            <label>Telefonszám *</label>
            <input type="tel" [(ngModel)]="customerData.phone" placeholder="+36 30 123 4567" required />
          </div>
        </div>
      </div>

      <!-- Delivery Address -->
      <div class="checkout-section">
        <div class="section-header">
          <h2 class="section-title">Szállítási Adatok</h2>
          <button class="use-saved-btn" (click)="useSavedAddress()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Mentett cím használata
          </button>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Ország *</label>
            <input type="text" [(ngModel)]="deliveryAddress.country" placeholder="Magyarország" required />
          </div>
          <div class="form-group">
            <label>Irányítószám *</label>
            <input type="text" [(ngModel)]="deliveryAddress.postalCode" placeholder="1234" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Város *</label>
            <input type="text" [(ngModel)]="deliveryAddress.city" placeholder="Budapest" required />
          </div>
          <div class="form-group">
            <label>Utca, Házszám *</label>
            <input type="text" [(ngModel)]="deliveryAddress.street" placeholder="Fő utca 12" required />
          </div>
        </div>
      </div>

      <!-- Delivery Method -->
      <div class="checkout-section">
        <h2 class="section-title">Átvételi Mód</h2>
        <div class="delivery-options">
          <div 
            *ngFor="let option of deliveryOptions"
            class="delivery-option"
            [class.selected]="selectedDeliveryMethod === option.id"
            (click)="selectDeliveryMethod(option.id)">
            <div class="option-icon">
              <img [src]="option.iconPath" [alt]="option.name" class="delivery-icon-img">
            </div>
            <div class="option-info">
              <h3 class="option-name">{{ option.name }}</h3>
              <p class="option-estimate">{{ option.estimatedDays }}</p>
            </div>
            <div class="option-price">
              {{ option.price === 0 ? 'Ingyenes' : formatPrice(option.price) }}
            </div>
            <div class="option-radio">
              <span class="radio" [class.checked]="selectedDeliveryMethod === option.id"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="checkout-section">
        <h2 class="section-title">Fizetési Mód</h2>
        <div class="payment-options">
          <div 
            *ngFor="let method of paymentMethods"
            class="payment-option"
            [class.selected]="selectedPaymentMethod === method.id"
            (click)="selectPaymentMethod(method.id)">
            <div class="payment-icon">
              <img [src]="method.iconPath" [alt]="method.name" class="payment-icon-img">
            </div>
            <div class="payment-name">{{ method.name }}</div>
            <div class="payment-radio">
              <span class="radio" [class.checked]="selectedPaymentMethod === method.id"></span>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Right Column: Summary -->
    <div class="checkout-summary">
      <div class="summary-card">
        <h2 class="summary-title">Rendelés Összegzése</h2>
        
        <div class="summary-row">
          <span>Termékek összesen:</span>
          <span>{{ formatPrice(getSubtotal()) }}</span>
        </div>
        
        <div class="summary-row">
          <span>Szállítási díj:</span>
          <span>{{ getDeliveryPrice() === 0 ? 'Ingyenes' : formatPrice(getDeliveryPrice()) }}</span>
        </div>
        
        <div class="summary-divider"></div>
        
        <div class="summary-total">
          <span>Fizetendő:</span>
          <span class="total-amount">{{ formatPrice(getTotal()) }}</span>
        </div>
        
        <button 
          class="place-order-btn" 
          [disabled]="!isFormValid()"
          (click)="placeOrder()">
          Rendelés leadása
        </button>

        <div class="security-notice">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          Biztonságos fizetés
        </div>
      </div>
    </div>

  </div>
</div>

<app-footer></app-footer>