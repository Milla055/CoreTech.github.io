<app-header></app-header>

<div class="container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-avatar">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    </div>
    
    <div class="profile-info">
      <div class="profile-name-row">
        <h1 class="profile-name">{{ userData?.username || 'Felhaszn√°l√≥' }}</h1>
        <span class="admin-badge" *ngIf="isAdmin()">Admin</span>
      </div>
      <p class="profile-email">{{ userData?.email }}</p>
      
      <div class="profile-tabs">
        <button 
          class="tab-button" 
          (click)="logout()">
          Kijelentkez√©s
        </button>
        <button 
          *ngIf="isAdmin()"
          class="tab-button admin-button"
          (click)="goToAdminPage()">
          Adminbe√°ll√≠t√°sok
        </button>
      </div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Kedvencek -->
  <div class="favorites-section">
    <button class="favorites-button" (click)="openFavoritesModal()">
      Kedvencek 
      <span class="favorites-count" *ngIf="favorites.length > 0">({{ favorites.length }})</span>
    </button>
  </div>

  <!-- Kedvencek Modal -->
  <div class="modal-overlay" *ngIf="isFavoritesModalOpen" (click)="closeFavoritesModal()">
    <div class="modal-content favorites-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Kedvenceim ({{ favorites.length }})</h2>
        <button class="modal-close-btn" (click)="closeFavoritesModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <!-- Loading -->
        <div class="loading-favorites" *ngIf="loadingFavorites">
          <p>Kedvencek bet√∂lt√©se...</p>
        </div>
        
        <!-- Kedvencek lista -->
        <div class="favorites-list" *ngIf="!loadingFavorites && favorites.length > 0">
          <div class="favorite-card" *ngFor="let item of favorites">
            <div class="favorite-image" (click)="goToProduct(item.id)">
              <img [src]="getProductImageUrl(item)" [alt]="item.name" />
            </div>
            <div class="favorite-info" (click)="goToProduct(item.id)">
              <h3 class="favorite-name">{{ item.name }}</h3>
              <p class="favorite-category">{{ item.categoryName }} - {{ item.brandName }}</p>
              <div class="favorite-price-row">
                <span class="favorite-price">{{ formatPrice(item.pPrice) }}</span>
                <span class="favorite-old-price" *ngIf="item.price !== item.pPrice">{{ formatPrice(item.price) }}</span>
              </div>
              <div class="favorite-stock" [ngClass]="isInStock(item) ? 'in-stock' : 'out-of-stock'">
                {{ isInStock(item) ? '‚úì K√©szleten (' + item.stock + ' db)' : '‚úó Nincs k√©szleten' }}
              </div>
            </div>
            <div class="favorite-actions">
              <button 
                class="add-to-cart-btn" 
                [disabled]="!isInStock(item)"
                (click)="addFavoriteToCart(item)"
                title="Kos√°rba">
                üõí
              </button>
              <button 
                class="remove-favorite-btn" 
                (click)="removeFavorite(item.id)"
                title="Elt√°vol√≠t√°s">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>
        
        <!-- √úres √°llapot -->
        <div class="no-favorites" *ngIf="!loadingFavorites && favorites.length === 0">
          <p>üò¢ M√©g nincs kedvenc term√©ked.</p>
          <p class="hint">Adj hozz√° term√©keket a kedvenceidhez a ‚ô° gombra kattintva!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Rendel√©seim -->
  <div class="orders-section">
    <button class="orders-button" (click)="openOrdersModal()">Rendel√©seim</button>
  </div>

  <!-- Rendel√©seim Modal -->
  <div class="modal-overlay" *ngIf="isOrdersModalOpen" (click)="closeOrdersModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Rendel√©seim</h2>
        <button class="modal-close-btn" (click)="closeOrdersModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="orders-list" *ngIf="mockOrders.length > 0">
          <div class="order-card" *ngFor="let order of mockOrders">
            <div class="order-header">
              <span class="order-id">#{{ order.id }}</span>
              <span class="order-status" [ngClass]="order.statusClass">{{ order.status }}</span>
            </div>
            <div class="order-date">{{ order.date }}</div>
            <div class="order-items">
              <div class="order-item" *ngFor="let item of order.items">
                <span class="item-name">{{ item.name }}</span>
                <span class="item-quantity">x{{ item.quantity }}</span>
                <span class="item-price">{{ formatPrice(item.price) }}</span>
              </div>
            </div>
            <div class="order-total">
              <span>√ñsszesen:</span>
              <span class="total-price">{{ formatPrice(order.total) }}</span>
            </div>
          </div>
        </div>
        <div class="no-orders" *ngIf="mockOrders.length === 0">
          <p>M√©g nincs rendel√©sed.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'fiokkezeles'" 
      (click)="setActiveTab('fiokkezeles')">
      Fi√≥kkezel√©s
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'adatok'" 
      (click)="setActiveTab('adatok')">
      Adatok
    </button>
  </div>

  <!-- Tab Content: Fi√≥kkezel√©s -->
  <div class="tab-content" *ngIf="activeTab === 'fiokkezeles'">
    <div class="form-section">
      <h3>V√°s√°rl√≥i adatok</h3>
      <form [formGroup]="customerDataForm">
        <div class="form-group">
          <label>Email c√≠m</label>
          <input type="email" formControlName="email" placeholder="Email c√≠m">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Vezet√©kn√©v</label>
            <input type="text" formControlName="vezetekNev" placeholder="Vezet√©kn√©v">
          </div>
          <div class="form-group">
            <label>Keresztn√©v</label>
            <input type="text" formControlName="keresztNev" placeholder="Keresztn√©v">
          </div>
        </div>
      </form>
    </div>

    <div class="form-section">
      <h3>Jelsz√≥ m√≥dos√≠t√°sa</h3>
      <form [formGroup]="passwordForm">
        <div class="form-group password-group">
          <label>R√©gi jelsz√≥</label>
          <div class="password-input-wrapper">
            <input [type]="showOldPassword ? 'text' : 'password'" formControlName="regiJelszo" placeholder="R√©gi jelsz√≥">
            <button type="button" class="toggle-password" (click)="togglePasswordVisibility('old')">
              {{ showOldPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
        </div>
        <div class="form-group password-group">
          <label>√öj jelsz√≥</label>
          <div class="password-input-wrapper">
            <input [type]="showNewPassword ? 'text' : 'password'" formControlName="ujJelszo" placeholder="√öj jelsz√≥ (min. 8 karakter)">
            <button type="button" class="toggle-password" (click)="togglePasswordVisibility('new')">
              {{ showNewPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
        </div>
        <div class="form-group password-group">
          <label>√öj jelsz√≥ meger≈ës√≠t√©se</label>
          <div class="password-input-wrapper">
            <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="ujJelszoMegerosites" placeholder="Jelsz√≥ meger≈ës√≠t√©se">
            <button type="button" class="toggle-password" (click)="togglePasswordVisibility('confirm')">
              {{ showConfirmPassword ? 'üôà' : 'üëÅÔ∏è' }}
            </button>
          </div>
        </div>
        <button type="button" class="change-password-btn" (click)="onPasswordChange()" [disabled]="isChangingPassword">
          {{ isChangingPassword ? 'Ment√©s...' : 'Jelsz√≥ m√≥dos√≠t√°sa' }}
        </button>
      </form>
    </div>

    <div class="form-section">
      <h3>Sz√°ll√≠t√°si adatok</h3>
      <form [formGroup]="deliveryDataForm">
        <div class="form-row">
          <div class="form-group">
            <label>Orsz√°g</label>
            <input type="text" formControlName="orszag" placeholder="Magyarorsz√°g">
          </div>
          <div class="form-group">
            <label>Ir√°ny√≠t√≥sz√°m</label>
            <input type="text" formControlName="iranyitoszam" placeholder="1234">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>V√°ros</label>
            <input type="text" formControlName="varos" placeholder="Budapest">
          </div>
          <div class="form-group">
            <label>Utca, h√°zsz√°m</label>
            <input type="text" formControlName="utcaHazszam" placeholder="F≈ë utca 1.">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label>Telefonsz√°m</label>
            <input type="tel" formControlName="telefonszam" placeholder="+36 30 123 4567">
          </div>
        </div>
      </form>
    </div>

    <div class="form-actions">
      <button class="save-btn" (click)="onSubmit()" [disabled]="isUpdatingProfile">
        {{ isUpdatingProfile ? 'Ment√©s...' : 'V√°ltoz√°sok ment√©se' }}
      </button>
      <button class="reset-btn" (click)="resetChanges()">Vissza√°ll√≠t√°s</button>
    </div>
  </div>

  <!-- Tab Content: Adatok -->
  <div class="tab-content" *ngIf="activeTab === 'adatok'">
    <div class="data-section">
      <div class="data-row">
        <span class="data-label">Felhaszn√°l√≥n√©v:</span>
        <span class="data-value">{{ userData?.username || '-' }}</span>
      </div>
      <div class="data-row">
        <span class="data-label">Email:</span>
        <span class="data-value">{{ userData?.email || '-' }}</span>
      </div>
      <div class="data-row">
        <span class="data-label">Teljes n√©v:</span>
        <span class="data-value">{{ getFullName() }}</span>
      </div>
      <div class="data-row">
        <span class="data-label">Telefonsz√°m:</span>
        <span class="data-value">{{ userData?.telefonszam || '-' }}</span>
      </div>
      <div class="data-row">
        <span class="data-label">C√≠m:</span>
        <span class="data-value">{{ getFullAddress() || '-' }}</span>
      </div>
      <div class="data-row">
        <span class="data-label">Szerepk√∂r:</span>
        <span class="data-value">{{ userData?.role || 'Felhaszn√°l√≥' }}</span>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>